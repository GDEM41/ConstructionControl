<Window x:Class="ConstructionControl.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ConstructionControl"
        Title="Журнал входного контроля"
        Height="650"
        Width="1150"
        Background="#F6F7FB">

    <!-- ================= СТИЛИ ================= -->
    <Window.Resources>

        <!-- Кнопка основная -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Height" Value="34"/>
            <Setter Property="MinWidth" Value="110"/>
            <Setter Property="Padding" Value="14,0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="#2563EB"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Margin" Value="0,0,6,0"/>
        </Style>

        <!-- Кнопка вторичная -->
        <Style x:Key="SecondaryButton" TargetType="Button"
               BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#E5E7EB"/>
            <Setter Property="Foreground" Value="#111827"/>
        </Style>
        <!-- Toolbar кнопка -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Width" Value="34"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="16"/>
        </Style>

        <!-- Toolbar кнопка -->
        <Style x:Key="IconToggle" TargetType="ToggleButton">
            <Setter Property="Width" Value="34"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="16"/>
        </Style>

    </Window.Resources>

    <DockPanel>

        <!-- ================= МЕНЮ ================= -->
        <Menu DockPanel.Dock="Top"
              Background="White"
              BorderThickness="0">
            <MenuItem Header="Создать" Click="CreateObject_Click"/>
            <MenuItem Header="Настройки объекта" Click="ObjectSettings_Click"/>
            <MenuItem Header="Выход" Click="Exit_Click"/>
        </Menu>

        <!-- ================= TOOLBAR ================= -->
        <Border DockPanel.Dock="Top"
                Background="White"
                BorderBrush="#E5E7EB"
                BorderThickness="0,0,0,1"
                Padding="6">

            <ToolBar Background="Transparent">

                <Button Style="{StaticResource IconButton}"
                        ToolTip="Сохранить"
                        Click="SaveButton_Click">
                    💾
                </Button>

                <ToggleButton Style="{StaticResource IconToggle}"
                              ToolTip="Блокировка"
                              Checked="LockToggle_Checked"
                              Unchecked="LockToggle_Unchecked">
                    🔒
                </ToggleButton>

                <Separator Margin="6,0"/>

                <Button Style="{StaticResource IconButton}" IsEnabled="False">↩</Button>
                <Button Style="{StaticResource IconButton}" IsEnabled="False">↪</Button>

                <Separator Margin="10,0"/>

                <Button Style="{StaticResource SecondaryButton}"
                        Click="ImportExcel_Click">
                    📥 Импорт Excel
                </Button>

            </ToolBar>
        </Border>

        <!-- ================= ОСНОВНАЯ ОБЛАСТЬ ================= -->
        <Grid Margin="10">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- ===== ДЕРЕВО ===== -->
            <Border Background="White"
                    CornerRadius="8"
                    Padding="6"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1">

                <TreeView x:Name="ObjectsTree"
                          SelectedItemChanged="ObjectsTree_SelectedItemChanged">

                    <TreeView.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Переименовать"
                                      Click="RenameTreeItem_Click"/>
                            <MenuItem Header="Удалить"
                                      Click="DeleteTreeItem_Click"/>
                        </ContextMenu>
                    </TreeView.ContextMenu>
                </TreeView>
            </Border>

            <!-- ===== КОНТЕНТ ===== -->
            <Border Grid.Column="1"
                    Background="White"
                    CornerRadius="8"
                    Padding="8"
                    Margin="10,0,0,0"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1">

                <TabControl BorderThickness="0">

                    <!-- ===== СВОДНАЯ ===== -->
                    <TabItem Header="Сводная таблица">
                        <DataGrid x:Name="SummaryGrid"
                                  Margin="8"
                                  IsReadOnly="True"
                                  AutoGenerateColumns="True"
                                  CanUserAddRows="False"
                                  GridLinesVisibility="None"/>
                    </TabItem>

                    <!-- ===== ЖВК ===== -->
                    <TabItem Header="ЖВК">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Панель кнопок -->
                            <StackPanel Grid.Row="0"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Right"
                                        Margin="0,4,0,6">

                                <Button Style="{StaticResource SecondaryButton}"
                                        Click="ToggleFilters_Click">
                                    🔍 Фильтры
                                </Button>

                                <Button Style="{StaticResource PrimaryButton}"
                                        Click="ExportToExcel_Click">
                                    ⬇ Экспорт
                                </Button>
                            </StackPanel>
                            <Border x:Name="FiltersPanel"
        Background="White"
        BorderBrush="#E5E7EB"
        BorderThickness="1"
        CornerRadius="8"
        Padding="10"
        Visibility="Collapsed"
        Margin="10"
        Panel.ZIndex="10">

                                <StackPanel>

                                    <TextBlock Text="Типы материалов"
                   FontWeight="SemiBold"/>

                                    <ListBox x:Name="FilterGroupsList"
                 Height="100"
                 SelectionMode="Extended"
                 SelectionChanged="Filters_Changed"/>

                                    <StackPanel Orientation="Horizontal"
                    Margin="0,6,0,0">
                                        <Button Content="Все"
                    Click="SelectAllGroups_Click"/>
                                        <Button Content="Очистить"
                    Margin="6,0,0,0"
                    Click="ClearGroups_Click"/>
                                    </StackPanel>

                                    <TextBlock Text="Период"
                   Margin="0,10,0,4"
                   FontWeight="SemiBold"/>

                                    <StackPanel Orientation="Horizontal">
                                        <DatePicker x:Name="DateFromPicker"
                        SelectedDateChanged="Filters_Changed"/>
                                        <TextBlock Text=" — "
                       VerticalAlignment="Center"/>
                                        <DatePicker x:Name="DateToPicker"
                        SelectedDateChanged="Filters_Changed"/>
                                    </StackPanel>

                                    <TextBlock Text="Поставщик"
                   Margin="0,10,0,4"
                   FontWeight="SemiBold"/>

                                    <TextBox x:Name="SupplierFilterBox"
                 TextChanged="Filters_Changed"/>

                                </StackPanel>
                            </Border>

                            <!-- Таблица -->
                            <DataGrid x:Name="JournalGrid"
                                      Grid.Row="1"
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="False"
                                      SelectionMode="Extended"
                                      GridLinesVisibility="None"
                                      PreviewKeyDown="JournalGrid_PreviewKeyDown">

                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Дата" Binding="{Binding Date, StringFormat=dd.MM.yyyy}"/>
                                    <DataGridTextColumn Header="Тип" Binding="{Binding MaterialGroup}"/>
                                    <DataGridTextColumn Header="Наименование" Binding="{Binding MaterialName}"/>
                                    <DataGridTextColumn Header="Кол-во" Binding="{Binding Quantity}"/>
                                    <DataGridTextColumn Header="Ед." Binding="{Binding Unit}"/>
                                    <DataGridTextColumn Header="ТТН" Binding="{Binding Ttn}"/>
                                    <DataGridTextColumn Header="Паспорт" Binding="{Binding Passport}"/>
                                    <DataGridTextColumn Header="СТБ" Binding="{Binding Stb}"/>
                                    <DataGridTextColumn Header="Поставщик" Binding="{Binding Supplier}"/>
                                </DataGrid.Columns>

                            </DataGrid>
                        </Grid>
                    </TabItem>

                    <!-- ===== ПРИХОД ===== -->
                    <TabItem Header="Приход">
                        <local:ArrivalControl x:Name="ArrivalPanel"/>
                    </TabItem>

                </TabControl>
            </Border>
        </Grid>
    </DockPanel>
</Window>
